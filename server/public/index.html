<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>WebRTC Data Channel Echo Server Example</title>
    <script type="module">
        let NUM_PACKETS = 20;
        let SEND_INTERVAL = 1;
        let ADDRESS = "/new_rtc_session";

        import init, {Connection} from "./pkg/client.js";

        async function run() {
            await init();

            let peer = new RTCPeerConnection({
                iceServers: [{
                    urls: ["stun:stun.l.google.com:19302"]
                }]
            });
            let channel = await Connection.connect(peer);
            console.log(peer.sctp);

            let i = 0;
            let loop = () => {
                channel.send_num(i);
                i++;
                if (i > 1) {
                    return;
                }
                requestAnimationFrame(loop);
            };
            loop();

            let p1 = channel.recv_fut().await();
            let p2 = channel.recv_fut().await();
            console.log(await p2);
            console.log(await p1);

            // setInterval(() => {
            //     while (true) {
            //         let v = channel.recv();
            //         if (v) {
            //             console.log(v);
            //         } else {
            //             break;
            //         }
            //     }
            // }, 100);
        }

        run();
    </script>
</head>
<body></body>
</html>
